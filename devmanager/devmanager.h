/*!
****************************************************************************************************
* 文件名称：devmanager.h
* 功能简介：该文件是设备管理器模块的头文件
* 文件作者：HQHP
* 创建日期：2025-05-08
* 版权声明：All Rights Reserved.
****************************************************************************************************
*/

#ifndef DEVMANAGER_DEVMANAGER_H_
#define DEVMANAGER_DEVMANAGER_H_

/*!
****************************************************************************************************
* 包含文件
****************************************************************************************************
*/
#include <hqhp/defs.h>
#include <hqhp/devmanager.h>

#ifdef __cplusplus
extern "C" {
#endif

/*!
****************************************************************************************************
* 常量定义
****************************************************************************************************
*/
#define UP_PID_MAX (10) // 上传参数最大数量

/*!
****************************************************************************************************
* 配置定义
****************************************************************************************************
*/
/* 通用控制参数 */
#define VALVE_CURRENT_MIN (4.0f)   // 阀门电流最小值 (mA)
#define VALVE_CURRENT_MAX (20.0f)  // 阀门电流最大值 (mA)
#define VFD_FREQ_MIN_HZ	  (0.0f)   // 变频器最小频率 (Hz)
#define VFD_FREQ_MAX_HZ	  (100.0f) // 变频器最大频率 (Hz)
#define VFD_FREQ_BASE	  (50.0f)  // 变频器基础频率 (Hz)
#define PID_PERIOD				   100	// PID计算周期(ms)

// 压力控制相关常量
#define PRESSURE_SP 0.8f // 压力设定值(MPa)

/*!
****************************************************************************************************
* 类型定义
****************************************************************************************************
*/

/*!
****************************************************************************************************
* 流量计设备类型枚举
****************************************************************************************************
*/
enum {
	DEVID_FLOW_MICRO = 1, // 艾默生-罗斯蒙特
	DEVID_FLOW_EH,		  // E+H
	DEVID_FLOW_ADS,		  // 安迪生
	DEVID_FLOW_MFC608,	  // MFC608性流量计
};

/*!
****************************************************************************************************
* ADC通道枚举
****************************************************************************************************
*/
enum {
	DRVID_ADC0 = 0,
	DRVID_ADC1,
	DRVID_ADC2,
	DRVID_ADC3,
	DRVID_ADC_NUMS
};

/*!
****************************************************************************************************
* PID控制器模块类型定义
****************************************************************************************************
*/

/*!
****************************************************************************************************
* PID内部参数索引枚举 (用于调试或特定场景访问)
****************************************************************************************************
*/
enum {
	//PID参数
	PARAM_PID_SP = 1, // 设定值
	PARAM_PID_ERR,	  // 误差值
	PARAM_PID_OUTPUT, // 输出值
	PARAM_PID_SUM,	  // 积分值
	PARAM_PID_KP_OUT, // 比例输出值
	PARAM_PID_KI_OUT, // 积分输出值
	PARAM_PID_KD_OUT, // 微分输出值
	//压力传感器参数
	PARAM_PT207_RANGE, // 压力传感器量程
	PARAM_PT207_LIMIT, // 压力传感器过压保护
	PARAM_PT207_RATIO, // 压力传感器缩放系数
	PARAM_PT207_DELTA, // 压力传感器偏移系数
	PARAM_PT206_RANGE, // 压力传感器量程
	PARAM_PT206_LIMIT, // 压力传感器过压保护
	PARAM_PT206_RATIO, // 压力传感器缩放系数
	PARAM_PT206_DELTA, // 压力传感器偏移系数	
	//流量计参数
	PARAM_FLOW_TYPE_ONE, // 流量计类型1
	PARAM_FLOW_LIMIT_ONE, // 流量计上限1
	PARAM_FLOW_TYPE_TWO, // 流量计类型2
	PARAM_FLOW_LIMIT_TWO, // 流量计上限2
	//设备编号
	PARAM_HW_DEV_NUM, // 设备编号
};

/*!
****************************************************************************************************
* 数字量输出设备枚举
****************************************************************************************************
*/
enum {
	DEVID_DO_G0, // 主板DO
	DEVID_DO_G1, // 扩展板1#DO
	DEVID_DO_G2	 // 扩展板2#DO
};

/*!
****************************************************************************************************
* 数字量输入设备枚举
****************************************************************************************************
*/
enum {
	DEVID_DI_G0, // 主板DI
	DEVID_DI_G1, // 扩展板1#DI
	DEVID_DI_G2	 // 扩展板2#DI
};

/*!
****************************************************************************************************
* 全局变量
****************************************************************************************************
*/

/*!
****************************************************************************************************
* 本地声明
****************************************************************************************************
*/

/*!
****************************************************************************************************
* 接口函数
****************************************************************************************************
*/
/*!
****************************************************************************************************
* 功能描述：初始化火警报警器模块
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：NA
****************************************************************************************************
*/
void DEVMGR_FireAlarInit(void);

/*!
****************************************************************************************************
* 功能描述：火警报警器模块周期处理函数
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：NA
****************************************************************************************************
*/
void DEVMGR_FireAlarmHandle(void);

/*!
****************************************************************************************************
* 流量计模块函数声明
****************************************************************************************************
*/
/*!
****************************************************************************************************
* 功能描述：初始化流量计模块
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：NA
****************************************************************************************************
*/
void DEVMGR_FlowInit(void);

/*!
****************************************************************************************************
* 功能描述：流量计模块周期处理函数
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：NA
****************************************************************************************************
*/
void DEVMGR_FlowHandle(void);

/*!
****************************************************************************************************
* 功能描述：恢复流量计模块的默认参数
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：0 成功；其他 失败错误码
****************************************************************************************************
*/
int DEVMGR_FlowRestoreDefaultPara(void);

/*!
****************************************************************************************************
* 功能描述：查询当前流量计类型
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：流量计类型 (参考 DEVID_FLOW_xxx 枚举)
****************************************************************************************************
*/
uint8_t DEVMGR_FlowInqType(void);

/*!
****************************************************************************************************
* 功能描述：查询流量上限值
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：流量上限值
****************************************************************************************************
*/
float DEVMGR_FlowInqLimit(void);

/*!
****************************************************************************************************
* 功能描述：更新流量计类型
* 注意事项：NA
* 输入参数：type -- 新的流量计类型 (参考 DEVID_FLOW_xxx 枚举)
* 输出参数：NA
* 返回参数：0 成功；其他 失败错误码
****************************************************************************************************
*/
int DEVMGR_FlowUpdateType(uint8_t type);

/*!
****************************************************************************************************
* 功能描述：更新流量上限值
* 注意事项：NA
* 输入参数：limit -- 新的流量上限值
* 输出参数：NA
* 返回参数：0 成功；其他 失败错误码
****************************************************************************************************
*/
int DEVMGR_FlowUpdateLimit(float limit);

/*!
****************************************************************************************************
* 功能描述：更新流量计参数 (类型和上限)
* 注意事项：NA
* 输入参数：type -- 新的流量计类型
*          limit -- 新的流量上限值
* 输出参数：NA
* 返回参数：0 成功；其他 失败错误码
****************************************************************************************************
*/
int DEVMGR_FlowUpdatePara(uint8_t type, float limit);

/*!
****************************************************************************************************
* 功能描述：使能流量过流检测
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：NA
****************************************************************************************************
*/
void DEVMGR_FlowOFlowChkEnable(void);

/*!
****************************************************************************************************
* 功能描述：禁止流量过流检测
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：NA
****************************************************************************************************
*/
void DEVMGR_FlowOFlowChkDisable(void);

/*!
****************************************************************************************************
* 功能描述：查询进气流量计是否在线
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：true 在线；false 离线
****************************************************************************************************
*/
bool DEVMGR_FlowIsFuelOnline(void);

/*!
****************************************************************************************************
* 功能描述：查询总累计流量是否已清除完成
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：true 清除完成；false 未完成或正在清除
****************************************************************************************************
*/
bool DEVMGR_FlowIsClearDone(void);

/*!
****************************************************************************************************
* 功能描述：查询总累计流量是否清除成功
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：true 清除成功；false 清除失败
****************************************************************************************************
*/
bool DEVMGR_FlowIsClearSucceed(void);

/*!
****************************************************************************************************
* 功能描述：查询进气流量计数据是否已刷新
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：true 已刷新；false 未刷新
****************************************************************************************************
*/
bool DEVMGR_FlowIsFuelRefresh(void);

/*!
****************************************************************************************************
* 功能描述：清除流量计的总累计流量
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：NA
****************************************************************************************************
*/
void DEVMGR_FlowClearTotal(void);

/*!
****************************************************************************************************
* 功能描述：清除流量计数据刷新标志
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：NA
****************************************************************************************************
*/
void DEVMGR_FlowClrRefresh(void);

/*!
****************************************************************************************************
* 功能描述：查询进气瞬时流量
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：进气瞬时流量值
****************************************************************************************************
*/
float DEVMGR_FlowInqJinQiFlow(void);

/*!
****************************************************************************************************
* 功能描述：查询进气累计气量
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：进气累计气量值
****************************************************************************************************
*/
float DEVMGR_FlowInqJinQiVolume(void);

/*!
****************************************************************************************************
* 功能描述：查询回气累计气量
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：回气累计气量值
****************************************************************************************************
*/
float DEVMGR_FlowInqHuiQiVolume(void);

/*!
****************************************************************************************************
* 功能描述：查询进气密度
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：进气密度值
****************************************************************************************************
*/
float DEVMGR_FlowInqJinQiDensity(void);

/*!
****************************************************************************************************
* 功能描述：查询进气增益
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：进气增益值
****************************************************************************************************
*/
float DEVMGR_FlowInqJinQiGain(void);

/*!
****************************************************************************************************
* 功能描述：查询进气温度
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：进气温度值
****************************************************************************************************
*/
float DEVMGR_FlowInqJinQiTemperature(void);

/*!
****************************************************************************************************
* 功能描述：设置阀门电流
* 注意事项：NA
* 输入参数：chN -- 通道号
*          current -- 电流值 (mA)
* 输出参数：NA
* 返回参数：设置结果，通常0表示成功
****************************************************************************************************
*/
uint8_t DEVMGR_ValveSetCurrent(uint8_t chN, float current);

/*!
****************************************************************************************************
* 功能描述：初始化PT206压力传感器
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：NA
****************************************************************************************************
*/
void DEVMGR_PT206Init(void);

/*!
****************************************************************************************************
* 功能描述：PT206压力传感器周期处理函数
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：NA
****************************************************************************************************
*/
void DEVMGR_PT206Handle(void);

/*!
****************************************************************************************************
* 功能描述：初始化PT207压力传感器
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：NA
****************************************************************************************************
*/
void DEVMGR_PT207Init(void);

/*!
****************************************************************************************************
* 功能描述：PT207压力传感器周期处理函数
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：NA
****************************************************************************************************
*/
void DEVMGR_PT207Handle(void);

/*!
****************************************************************************************************
* VDF处理函数
****************************************************************************************************
*/
void DEVMGR_VFDInit(uint8_t id);
void DEVMGR_VFDHandle(void);

#ifdef __cplusplus
}
#endif
#endif /* DEVMANAGER_DEVMANAGER_H_ */
