/*!
****************************************************************************************************
* 文件名称：devmanager-pt207.c
* 功能简介：该文件是设备管理器PT206设备模块的实现源文件
* 文件作者：Haotian
* 创建日期：2020-09-17
* 版权声明：All Rights Reserved.
****************************************************************************************************
*/
#include <hqhp/devmanager.h>
#include "sysmanager.h"

/*!
****************************************************************************************************
* 常量定义
****************************************************************************************************
*/

/*!
****************************************************************************************************
* 类型定义
****************************************************************************************************
*/
struct _WORK_INFO {
	uint8_t		  State;
	struct _TIMER Tmr;
};

/*!
****************************************************************************************************
* 全局变量
****************************************************************************************************
*/
static struct _WORK_INFO G_WRKMGR;

/*!
****************************************************************************************************
* 本地声明
****************************************************************************************************
*/

/*!
****************************************************************************************************
* 接口函数
****************************************************************************************************
*/
/*!
****************************************************************************************************
* 功能描述：该方法用于初始化不可操作状态流程
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：如果初始化成功返回TRUE，否则返回FALSE
****************************************************************************************************
*/
bool SYSMGR_VFDstartInit(void)
{
	G_WRKMGR.State = WORK_INIT;
	DRVMGR_TimerStart(&G_WRKMGR.Tmr, 50);

	return true;
}

/*!
****************************************************************************************************
* 功能描述：该方法用于判断不可操作状态流程是否执行完毕
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：如果执行完毕返回TRUE，否则返回FALSE
****************************************************************************************************
*/
bool SYSMGR_VFDstartIsDone(void)
{
	return (G_WRKMGR.State == WORK_DONE);
}

/*!
****************************************************************************************************
* 功能描述：该方法用于处理不可操作状态流程事务
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：NA
****************************************************************************************************
*/
void SYSMGR_VFDstartHandle(void)
{
	switch (G_WRKMGR.State) {
		case WORK_DONE:
			break;

		case WORK_INIT:
			//进入看空闲状态查看泵是否已经关闭，如果未关闭则立即关闭泵。
			if (DRVMGR_TimerIsExpiration(&G_WRKMGR.Tmr)) {
				DRVMGR_TimerStart(&G_WRKMGR.Tmr, 50);
				if (DEVMGR_VFDGetStatusWord() != 0x233) {
					DEVMGR_VFDStop();
					break;
				}
			}
			break;

		case WORK_DOING:
			break;
		default:
			break;
	}
}

/*!
****************************************************************************************************
* 本地函数
****************************************************************************************************
*/
/*!
****************************************************************************************************
* 功能描述：
* 注意事项：NA
* 输入参数：NA
* 输出参数：NA
* 返回参数：NA
****************************************************************************************************
*/
